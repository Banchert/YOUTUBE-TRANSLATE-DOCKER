<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Playback Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        video {
            width: 100%;
            height: auto;
            background: #000;
        }
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #2196f3;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border-left-color: #4caf50;
            color: #2e7d32;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ YouTube Video Translator - Video Playback Test</h1>
        
        <div class="test-info">
            <h3>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ü‡∏ã</h3>
            <p>‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            <div id="backendWarning" class="error" style="display: none;">
                <h4>‚ö†Ô∏è Backend ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô!</h4>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° Docker Services ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
                <ol>
                    <li>‡πÄ‡∏õ‡∏¥‡∏î Docker Desktop</li>
                    <li>‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå: <code>Quick-Fix-Backend.bat</code></li>
                    <li>‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: <code>docker compose -f docker/docker-compose-simple.yml up -d</code></li>
                    <li>‡∏£‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</li>
                </ol>
            </div>
        </div>

        <h2>1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Demo Video</h2>
        <video id="demoVideo" controls preload="metadata">
            <source src="http://localhost:8000/download/task-1754404431054" type="video/mp4">
            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</p>
            <ul>
                <li>‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå Backend ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà port 8000</li>
                <li>‡πÑ‡∏ü‡∏•‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á</li>
                <li>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS</li>
            </ul>
        </video>

        <div style="margin: 20px 0;">
            <button onclick="testVideoLoad()">üîÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</button>
            <button onclick="testBackendConnection()">üåê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend</button>
            <button onclick="testFileExists()">üìÅ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</button>
            <button onclick="clearLogs()">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Log</button>
        </div>

        <div id="logs" class="log"></div>

        <h2>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ</h2>
        <div>
            <label>Video URL: </label>
            <input type="text" id="videoUrl" value="http://localhost:8000/static/final_task-1754404431054.mp4" style="width: 500px; padding: 5px;">
            <button onclick="loadCustomVideo()">‡πÇ‡∏´‡∏•‡∏î</button>
        </div>
        
        <div style="margin: 10px 0;">
            <h3>üîó URL ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h3>
            <button onclick="setUrl('http://localhost:8000/static/final_task-1754404431054.mp4')">Static URL</button>
            <button onclick="setUrl('http://localhost:8000/download/task-1754404431054')">Download URL</button>
            <button onclick="testApiTaskStatus()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Task Status</button>
        </div>

        <video id="customVideo" controls preload="metadata" style="margin-top: 10px;">
            <p>‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô</p>
        </video>

        <h2>3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏ö‡∏±‡∏Å</h2>
        <div class="test-info">
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>Video Support:</strong> <span id="videoSupport"></span></p>
            <p><strong>Network Status:</strong> <span id="networkStatus"></span></p>
            <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#333';
            logs.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testBackendConnection() {
            log('üåê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend...', 'info');
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Backend ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ: ${JSON.stringify(data)}`, 'success');
                    document.getElementById('backendWarning').style.display = 'none';
                } else {
                    log(`‚ùå Backend ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö HTTP ${response.status}`, 'error');
                    showBackendWarning();
                }
            } catch (error) {
                log(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend: ${error.message}`, 'error');
                showBackendWarning();
            }
        }

        function showBackendWarning() {
            const warning = document.getElementById('backendWarning');
            warning.style.display = 'block';
            warning.scrollIntoView({ behavior: 'smooth' });
        }

        async function testFileExists() {
            log('üìÅ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...', 'info');
            
            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö static path
            try {
                const staticResponse = await fetch('http://localhost:8000/static/final_task-1754404431054.mp4', { method: 'HEAD' });
                if (staticResponse.ok) {
                    const contentLength = staticResponse.headers.get('content-length');
                    const contentType = staticResponse.headers.get('content-type');
                    log(`‚úÖ Static file ‡∏û‡∏ö: ${contentType}, ‡∏Ç‡∏ô‡∏≤‡∏î: ${contentLength} bytes`, 'success');
                } else {
                    log(`‚ùå Static file ‡πÑ‡∏°‡πà‡∏û‡∏ö: HTTP ${staticResponse.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö static file: ${error.message}`, 'error');
            }
            
            // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö download path
            try {
                const downloadResponse = await fetch('http://localhost:8000/download/task-1754404431054', { method: 'HEAD' });
                if (downloadResponse.ok) {
                    const contentLength = downloadResponse.headers.get('content-length');
                    const contentType = downloadResponse.headers.get('content-type');
                    log(`‚úÖ Download endpoint ‡∏û‡∏ö: ${contentType}, ‡∏Ç‡∏ô‡∏≤‡∏î: ${contentLength} bytes`, 'success');
                } else {
                    log(`‚ùå Download endpoint ‡πÑ‡∏°‡πà‡∏û‡∏ö: HTTP ${downloadResponse.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö download endpoint: ${error.message}`, 'error');
            }
        }
        
        function setUrl(url) {
            document.getElementById('videoUrl').value = url;
            log(`üîó ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÄ‡∏õ‡πá‡∏ô: ${url}`, 'info');
        }
        
        async function testApiTaskStatus() {
            log('üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Task Status...', 'info');
            try {
                const response = await fetch('http://localhost:8000/status/task-1754404431054');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Task Status: ${JSON.stringify(data, null, 2)}`, 'success');
                    
                    // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ video_url ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    if (data.video_url) {
                        log(`üé¨ ‡∏û‡∏ö video_url: ${data.video_url}`, 'info');
                        document.getElementById('videoUrl').value = `http://localhost:8000${data.video_url}`;
                    }
                } else {
                    log(`‚ùå Task Status API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Task Status API: ${error.message}`, 'error');
            }
        }

        function testVideoLoad() {
            log('üîÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...', 'info');
            const video = document.getElementById('demoVideo');
            
            video.onloadstart = () => log('üìä ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠', 'info');
            video.onloadedmetadata = () => log('üìã ‡πÇ‡∏´‡∏•‡∏î metadata ‡πÄ‡∏™‡∏£‡πá‡∏à', 'success');
            video.oncanplay = () => log('‚ñ∂Ô∏è ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô', 'success');
            video.onerror = (e) => log(`‚ùå Error ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠: ${e.target.error?.message || 'Unknown error'}`, 'error');
            
            video.load(); // Force reload
        }

        function loadCustomVideo() {
            const url = document.getElementById('videoUrl').value;
            const video = document.getElementById('customVideo');
            
            log(`üîÑ ‡πÇ‡∏´‡∏•‡∏î URL: ${url}`, 'info');
            
            video.onloadstart = () => log('üìä ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î custom video', 'info');
            video.onloadedmetadata = () => log('üìã ‡πÇ‡∏´‡∏•‡∏î custom metadata ‡πÄ‡∏™‡∏£‡πá‡∏à', 'success');
            video.oncanplay = () => log('‚ñ∂Ô∏è Custom video ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô', 'success');
            video.onerror = (e) => log(`‚ùå Error ‡πÇ‡∏´‡∏•‡∏î custom video: ${e.target.error?.message || 'Unknown error'}`, 'error');
            
            video.src = url;
            video.load();
        }

        // Initialize debug info
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('videoSupport').textContent = document.createElement('video').canPlayType('video/mp4') ? 'MP4 ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö' : 'MP4 ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
        document.getElementById('networkStatus').textContent = navigator.onLine ? 'Online' : 'Offline';
        document.getElementById('currentUrl').textContent = window.location.href;

        // Auto-test on load
        window.onload = function() {
            log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...', 'info');
            setTimeout(testBackendConnection, 1000);
            setTimeout(testFileExists, 2000);
            setTimeout(testVideoLoad, 3000);
        };
    </script>
</body>
</html>
